import React from "react";
import Card from "@material-ui/core/Card";
import CircularProgress from "@material-ui/core/CircularProgress";
import Box from "@material-ui/core/Box";

import Button from "react-bootstrap/Button";
import Sidebar from "../applications/sidebar";
import Navbar from "../applications/navbar";
import { useEffect, useState } from "react";
import "../applications/tabler.min.css";
import "../applications/style.css";

const Web3 = require("web3");
const loan = require("../../../../contracts/LoanProfile.json");
const homecrowdToken = require("../../../../contracts/HomeCrowdToken.json");
const tokenUSDC = require("../../../../contracts/USDCInterface.json");
const ALCHEMY_KEY =
  "wss://eth-goerli.g.alchemy.com/v2/Zl0NHp   _DT9kWIHiYsRyx3SEHtrDHyl5x";
const web3 = new Web3(new Web3.providers.HttpProvider(ALCHEMY_KEY));

const loanContractAddress = "0xe1dBF785115138c4268fABc8673183C6503AC279";
const myAddress = "0xc6a3dd9e9d73eb3e66669534ed21ee169aed7f14"; // User wallet -- change this if need be
const homeCrowdTokenAddress = "0x7eA6Fa6b5245a93870F43AFd00B4ea8808b01121";

export default function Verified() {
  const bytecode =
    "0x60806040526040518060400160405280600a81526020017f4d6f727467616765204100000000000000000000000000000000000000000000815250600190816200004a91906200070d565b5073d12f27341f3493c8c33d6069933d9c867e65bdfc600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507307865c6e87b9f70255377e024ace6630c1eaa37f600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600a60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503480156200016557600080fd5b50604051620020d8380380620020d883398181016040528101906200018b91906200088f565b620001bd620001a8620002f5640100000000026401000000009004565b620002fd640100000000026401000000009004565b620001d6620003c1640100000000026401000000009004565b83600781905550826003819055508160048190555042600581905550600060068190555080600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166340c10f193060646040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401620002b792919062000955565b600060405180830381600087803b158015620002d257600080fd5b505af1158015620002e7573d6000803e3d6000fd5b505050505050505062000a05565b600033905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b620003da620002f5640100000000026401000000009004565b73ffffffffffffffffffffffffffffffffffffffff166200040962000464640100000000026401000000009004565b73ffffffffffffffffffffffffffffffffffffffff161462000462576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200045990620009e3565b60405180910390fd5b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200050f57607f821691505b602082108103620005255762000524620004c7565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b60008160020a8302905092915050565b600060088302620005927fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000550565b6200059e868362000550565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620005eb620005e5620005df84620005b6565b620005c0565b620005b6565b9050919050565b6000819050919050565b6200060783620005ca565b6200061f6200061682620005f2565b84845462000560565b825550505050565b600090565b6200063662000627565b62000643818484620005fc565b505050565b5b818110156200066b576200065f6000826200062c565b60018101905062000649565b5050565b601f821115620006ba5762000684816200052b565b6200068f8462000540565b810160208510156200069f578190505b620006b7620006ae8562000540565b83018262000648565b50505b505050565b60008160020a8304905092915050565b6000620006e260001984600802620006bf565b1980831691505092915050565b6000620006fd8383620006cf565b9150826002028217905092915050565b62000718826200048d565b67ffffffffffffffff81111562000734576200073362000498565b5b620007408254620004f6565b6200074d8282856200066f565b600060209050601f83116001811462000785576000841562000770578287015190505b6200077c8582620006ef565b865550620007ec565b601f19841662000795866200052b565b60005b82811015620007bf5784890151825560018201915060208501945060208101905062000798565b86831015620007df5784890151620007db601f891682620006cf565b8355505b6001600288020188555050505b505050505050565b600080fd5b6200080481620005b6565b81146200081057600080fd5b50565b6000815190506200082481620007f9565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600062000857826200082a565b9050919050565b62000869816200084a565b81146200087557600080fd5b50565b60008151905062000889816200085e565b92915050565b60008060008060808587031215620008ac57620008ab620007f4565b5b6000620008bc8782880162000813565b9450506020620008cf8782880162000813565b9350506040620008e28782880162000813565b9250506060620008f58782880162000878565b91505092959194509250565b6200090c816200084a565b82525050565b6000819050919050565b60006200093d62000937620009318462000912565b620005c0565b620005b6565b9050919050565b6200094f816200091c565b82525050565b60006040820190506200096c600083018562000901565b6200097b602083018462000944565b9392505050565b600082825260208201905092915050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000620009cb60208362000982565b9150620009d88262000993565b602082019050919050565b60006020820190508181036000830152620009fe81620009bc565b9050919050565b6116c38062000a156000396000f3fe608060405260043610610126576000357c0100000000000000000000000000000000000000000000000000000000900480639d585f7f116100b2578063e930320911610081578063e930320914610359578063edb9a5c014610384578063f1653f6e146103c1578063f2fde38b146103ec578063fc0c546a1461041557610126565b80639d585f7f1461029d578063b6b55f25146102c8578063c95669a5146102f1578063cff774441461031c57610126565b806362833fcf116100f957806362833fcf146101c85780636831074914610205578063715018a614610230578063802c6ee5146102475780638da5cb5b1461027257610126565b806306fdde031461012b5780633e79d1e1146101565780633feb5f2b14610181578063590e1ae3146101be575b600080fd5b34801561013757600080fd5b50610140610440565b60405161014d9190610fa8565b60405180910390f35b34801561016257600080fd5b5061016b6104ce565b6040516101789190610fe3565b60405180910390f35b34801561018d57600080fd5b506101a860048036038101906101a3919061102f565b6104d4565b6040516101b5919061109d565b60405180910390f35b6101c6610513565b005b3480156101d457600080fd5b506101ef60048036038101906101ea91906110e4565b6107f8565b6040516101fc919061112c565b60405180910390f35b34801561021157600080fd5b5061021a610818565b604051610227919061109d565b60405180910390f35b34801561023c57600080fd5b5061024561083e565b005b34801561025357600080fd5b5061025c610852565b6040516102699190610fe3565b60405180910390f35b34801561027e57600080fd5b50610287610858565b604051610294919061109d565b60405180910390f35b3480156102a957600080fd5b506102b2610881565b6040516102bf9190610fe3565b60405180910390f35b3480156102d457600080fd5b506102ef60048036038101906102ea919061102f565b610887565b005b3480156102fd57600080fd5b50610306610bd6565b6040516103139190610fe3565b60405180910390f35b34801561032857600080fd5b50610343600480360381019061033e91906110e4565b610bdc565b6040516103509190610fe3565b60405180910390f35b34801561036557600080fd5b5061036e610bf4565b60405161037b919061109d565b60405180910390f35b34801561039057600080fd5b506103ab60048036038101906103a691906110e4565b610c1a565b6040516103b8919061112c565b60405180910390f35b3480156103cd57600080fd5b506103d6610c3a565b6040516103e39190610fe3565b60405180910390f35b3480156103f857600080fd5b50610413600480360381019061040e91906110e4565b610c40565b005b34801561042157600080fd5b5061042a610cc3565b60405161043791906111a6565b60405180910390f35b6001805461044d906111f0565b80601f0160208091040260200160405190810160405280929190818152602001828054610479906111f0565b80156104c65780601f1061049b576101008083540402835291602001916104c6565b820191906000526020600020905b8154815290600101906020018083116104a957829003601f168201915b505050505081565b60045481565b600b81815481106104e457600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6004546005546105239190611250565b421015610565576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161055c90611318565b60405180910390fd5b600e60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166105f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105e890611384565b60405180910390fd5b6000600c60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050803414610677576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161066e906113f0565b60405180910390fd5b600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd3033846040518463ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004016106f293929190611410565b6020604051808303816000875af1158015610711573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107359190611473565b50600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004016107b193929190611410565b6020604051808303816000875af11580156107d0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107f49190611473565b5050565b600e6020528060005260406000206000915054906101000a900460ff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610846610ce9565b6108506000610d67565b565b60065481565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60035481565b600081116108ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108c1906114ec565b60405180910390fd5b600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040161094593929190611410565b6020604051808303816000875af1158015610964573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906109889190611473565b5080600c60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546109d49190611250565b600c60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600d60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610acc57600b339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b6001600e60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600d60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555080600654610b8a9190611250565b600681905550610b9a3382610e2b565b7f0475eed5ceac333c1b6f34394bc989a7fe3cf18cb633600c42e8fb5a3a02c301600654604051610bcb9190610fe3565b60405180910390a150565b60075481565b600c6020528060005260406000206000915090505481565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600d6020528060005260406000206000915054906101000a900460ff1681565b60055481565b610c48610ce9565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610cb7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cae9061157e565b60405180910390fd5b610cc081610d67565b50565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610cf1610efe565b73ffffffffffffffffffffffffffffffffffffffff16610d0f610858565b73ffffffffffffffffffffffffffffffffffffffff1614610d65576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d5c906115ea565b60405180910390fd5b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb8383610e73610f06565b610e7d919061160a565b6040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401610eb6929190611664565b6020604051808303816000875af1158015610ed5573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610ef99190611473565b505050565b600033905090565b60006001905090565b600081519050919050565b600082825260208201905092915050565b60005b83811015610f49578082015181840152602081019050610f2e565b83811115610f58576000848401525b50505050565b6000601f19601f8301169050919050565b6000610f7a82610f0f565b610f848185610f1a565b9350610f94818560208601610f2b565b610f9d81610f5e565b840191505092915050565b60006020820190508181036000830152610fc28184610f6f565b905092915050565b6000819050919050565b610fdd81610fca565b82525050565b6000602082019050610ff86000830184610fd4565b92915050565b600080fd5b61100c81610fca565b811461101757600080fd5b50565b60008135905061102981611003565b92915050565b60006020828403121561104557611044610ffe565b5b60006110538482850161101a565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006110878261105c565b9050919050565b6110978161107c565b82525050565b60006020820190506110b2600083018461108e565b92915050565b6110c18161107c565b81146110cc57600080fd5b50565b6000813590506110de816110b8565b92915050565b6000602082840312156110fa576110f9610ffe565b5b6000611108848285016110cf565b91505092915050565b60008115159050919050565b61112681611111565b82525050565b6000602082019050611141600083018461111d565b92915050565b6000819050919050565b600061116c6111676111628461105c565b611147565b61105c565b9050919050565b600061117e82611151565b9050919050565b600061119082611173565b9050919050565b6111a081611185565b82525050565b60006020820190506111bb6000830184611197565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061120857607f821691505b60208210810361121b5761121a6111c1565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061125b82610fca565b915061126683610fca565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561129b5761129a611221565b5b828201905092915050565b7f546865206c6f616e20706572696f64206861736e27742070617373656420796560008201527f7400000000000000000000000000000000000000000000000000000000000000602082015250565b6000611302602183610f1a565b915061130d826112a6565b604082019050919050565b60006020820190508181036000830152611331816112f5565b9050919050565b7f596f75277265206e6f7420616e20696e766573746f7200000000000000000000600082015250565b600061136e601683610f1a565b915061137982611338565b602082019050919050565b6000602082019050818103600083015261139d81611361565b9050919050565b7f416d6f756e74206f6620746f6b656e7320696e76616c69640000000000000000600082015250565b60006113da601883610f1a565b91506113e5826113a4565b602082019050919050565b60006020820190508181036000830152611409816113cd565b9050919050565b6000606082019050611425600083018661108e565b611432602083018561108e565b61143f6040830184610fd4565b949350505050565b61145081611111565b811461145b57600080fd5b50565b60008151905061146d81611447565b92915050565b60006020828403121561148957611488610ffe565b5b60006114978482850161145e565b91505092915050565b7f416d6f756e742063616e6e6f7420626520300000000000000000000000000000600082015250565b60006114d6601283610f1a565b91506114e1826114a0565b602082019050919050565b60006020820190508181036000830152611505816114c9565b9050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b6000611568602683610f1a565b91506115738261150c565b604082019050919050565b600060208201905081810360008301526115978161155b565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b60006115d4602083610f1a565b91506115df8261159e565b602082019050919050565b60006020820190508181036000830152611603816115c7565b9050919050565b600061161582610fca565b915061162083610fca565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561165957611658611221565b5b828202905092915050565b6000604082019050611679600083018561108e565b6116866020830184610fd4565b939250505056fea264697066735822122048361ea628931a71546751bcc8fc238d9efc8e239855e1a3173704dae581883664736f6c634300080f0033";

  const [name, setName] = useState("");
  const [loans, setloans] = useState([]);
  const [id, setId] = useState();
  const [kycId, setKycId] = useState(1);

  const [currentAccount, setCurrentAccount] = useState("");
  const [contractAddress, setContractAddress] = useState("");
  const [loanAmount, setLoanAmount] = useState(0);
  const [timePeriod, setTimePeriod] = useState([
    {
      id: 1,
      timeperiod: 100,
    },
    {
      id: 2,
      timeperiod: 100,
    },
    {
      id: 3,
      timeperiod: 100,
    },
    {
      id: 4,
      timeperiod: 100,
    },
    {
      id: 5,
      timeperiod: 100,
    },
  ]);

  const checkWalletIsConnected = () => {
    const { ethereum } = window;

    if (!ethereum) {
      console.log("Make sure you have Metamask installed!");
      return;
    } else {
      console.log("Wallet exists! We're ready to go!");
    }
  };

  const connectWalletHandler = async () => {
    const { ethereum } = window;
    if (!ethereum) {
      alert("Please install Metamask!");
    }

    try {
      const accounts = await window.ethereum.request({
        method: "eth_requestAccounts",
      });

      console.log("Found an account! Address: ", accounts[0]);
      setCurrentAccount(accounts[0]);
    } catch (err) {
      console.log(err);
    }
  };

  // Get a list of loans from Db
  const getLoans = async () => {
    await fetch("https://lit-reef-14615.herokuapp.com/loan/")
      .then((response) => response.json())
      .then((data) => {
        setloans(data);
        // console.log(data);
      })
      .catch((err) => {
        console.log(err.message);
      });
  };

  const changeTP = (e, id) => {
    setTimePeriod((timePeriod) =>
      timePeriod.map((list, index) => {
        return index === id - 1
          ? {
              ...list,
              timeperiod: e.target.value,
            }
          : list;
      })
    );
  };

  // POST method for loan contract
  const addLoanContract = async (ca, id, tp, la, tc) => {
    await fetch("http://localhost:5002/loanContract/createloanContract", {
      method: "POST",
      body: JSON.stringify({
        contractAddress: ca,
        loanId: id,
        collectedAmount: 0,
        timePeriod: tp,
        loanAmount: la,
        timeCreated: tc,
      }),
      headers: {
        "Content-type": "application/json; charset=UTF-8",
      },
    })
      .then((response) => response.json())
      .catch((err) => {
        console.log(err.message);
      });
  };

  // Get loans when the page loads up
  useEffect(() => {
    checkWalletIsConnected();
    getLoans();
  }, []);

  const deployContract = async (loan_id, loan_amount, time_period) => {
    try {
      const { ethereum } = window;
      const web3 = new Web3(ethereum);
      console.log(timePeriod);
      let ca = 0;
      let amount = loan_amount;
      let tp = time_period;

      const loanProfileContract = new web3.eth.Contract(
        loan.abi,
        loanContractAddress
      );
      console.log({ loan_id, amount, tp, homeCrowdTokenAddress });

      let deploy = await loanProfileContract
        .deploy({
          data: bytecode,
          arguments: [loan_id, amount, tp, homeCrowdTokenAddress],
        })
        .send(
          {
            from: currentAccount,
            gas: 5000000,
            gasPrice: 2500000011,
          },
          function (error, transactionHash) {
            console.log(transactionHash);
          }
        )
        .on("error", function (error) {
          console.log(error);
        })
        .on("receipt", function (receipt) {
          ca = receipt["contractAddress"];
          setContractAddress(ca);
          console.log("CA", receipt["contractAddress"]); // contains the new contract address
        });

      alert("deployment successful");
      console.log(deploy);
      // addLoanContract(ca, loans[key].id, tp, amount,new Date().getTime());
    } catch (err) {
      console.log(err);
      alert("deposit failed");
    }
  };

  const handleClick = (e, id, amount, period, tp) => {
    console.log({ id, amount, period }); // period is input campagin
    // e.preventDefault();

    // deployContract(id, amount, tp);
  };

  return (
    <div className="wrapper">
      {/* <Sidebar/> */}
      <Navbar />
      <div className="main">
        <div className="d-print-none">
          <div className="row">
            <div className="col">
              <h2 className="pretitle">Applications Management</h2>
              <h2 className="page-title">Loan Application</h2>
            </div>
            <div className="col-auto ms-auto d-print-none pb-2">
              {currentAccount ? (
                <div className="col-auto ms-auto d-print-none pb-2">
                  <Button variant="secondary" onClick={connectWalletHandler}>
                    {currentAccount}{" "}
                  </Button>
                </div>
              ) : (
                <div className="col-auto ms-auto d-print-none pb-2">
                  <Button variant="secondary" onClick={connectWalletHandler}>
                    Connect Wallet
                  </Button>
                </div>
              )}{" "}
            </div>
            <div className="col-auto ms-auto d-print-none pb-2">
              <Button variant="primary">Insert New</Button>
              {""}{" "}
            </div>
          </div>
        </div>
        <div className="row">
          <div className="col-md-12 loantable">
            <Card
              style={{
                textAlign: "left",
                position: "relative",
                display: "flex",
                flexDirection: "column",
              }}
            >
              <div class="table-responsive-sm">
                <table
                  className="table table-striped table-bordered table-vcenter"
                  cellpadding="0"
                  cellspacing="0"
                >
                  <thead>
                    <tr>
                      <th>LOAN ID</th>
                      <th>LOAN AMOUNT</th>
                      <th>TIME PERIOD</th>
                      <th>STATUS</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {loans.length > 0 ? (
                      <>
                        {loans.map((val, key) => {
                          return (
                            <tr key={key}>
                              <td> {val.loan_id} </td>

                              <td>{val.loan_amt}</td>

                              <td>
                                <input
                                  type="number"
                                  placeholder="Campaign Period"
                                  name={val.id}
                                  onChange={(e) => {
                                    const changedArr = [];
                                    const timePeriod = Number(e.target.value);
                                    loans.map((loan) => {
                                      if (loan.loan_id === val.loan_id) {
                                        changedArr.push({
                                          ...loan,
                                          loan_term: timePeriod,
                                        });
                                      } else {
                                        changedArr.push(loan);
                                      }
                                    });
                                    setloans([...changedArr]);
                                  }}
                                ></input>
                              </td>
                              <td>
                                <span className="text-success">Approved</span>
                              </td>
                              <td className="text-center">
                                <a href="#">
                                  <Button
                                    variant="primary"
                                    onClick={(e) =>
                                      handleClick(
                                        e,
                                        val.loan_id,
                                        val.loan_amt,
                                        val.loan_term,
                                        2592000
                                      )
                                    }
                                  >
                                    Deploy
                                  </Button>
                                </a>
                              </td>
                            </tr>
                          );
                        })}
                      </>
                    ) : (
                      <tr>
                        <td colspan="5">
                          <Box sx={{ textAlign: "center", my: 5 }}>
                            <CircularProgress />
                          </Box>
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}
